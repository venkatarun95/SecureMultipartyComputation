#include <stdio.h>

#include <openssl/conf.h>
#include <openssl/bn.h>
#include <openssl/rand.h>

int main() {
	BIGNUM bn_one;
	BIGNUM* pc, upper_pc;
	BN_init(&bn_one);
	BN_init(&upper_pc);
	BN_one(&bn_one);

	int num_tried = 0;
	while (1) {
		// Generate a safe prime
		pc = BN_generate_prime(NULL, 1024, 1, NULL, NULL, NULL, NULL);
		// compute 2*(safe prime) + 1
		BN_lshift1(&upper_pc, pc);
		BN_add(&upper_pc, &upper_pc, &bn_one);
		// Check if it is a prime too
		if (BN_is_prime_fasttest(&upper_pc, BN_prime_checks, NULL, NULL, NULL, 1)) {
			char* hexString = BN_bn2hex(pc);
			printf("Doubly Safe Prime:\n\n%s\n", hexString);
			break;
		}
		// Nope, free resources and try again
		BN_free(pc);
		++ num_tried;
		if (num_tried % 1 == 0) {
			printf("%d ", num_tried);
			fflush(stdout);
		}
	}
}


// 512 bit doubly safe primes (middle number)

// F0FB40DEB55DDBB6F108C251A913B9F31F082A761BC4CEA052257CE166FC6AC5502DBBE8384801E220115B77E2E166356A6CDAA49AA840B5D0FFF09F00144BEB

// CBB79B73C0434FF42E74DC4A6768F517338A9C39C8BC9F6BC2E218AC4E188F8561D6DCB823F831614DC8BE72212BBBFDC918AB7DEFD0E726574B9CE6E7230E63

// F0C7E9E700668ECC9EB1360BF1DD01ED7CF74E6A5BF5DC71A53A47ED95CEC4DC90D0A78CACEAFF018EC656A2EB1A736CB2F9BCCC63D297A797CA403488D5979F


// 1024 bit doubly safe primes (middle number)

// C4FFF7B595CC4E7D3F2599324530A1737D385F1343267C86BB60BE05B624A1F516E43DB47C6B3C68668143389E084FA3CAF7E86B653E9049FF4BB3E2E1650D197668362E911C49D72B93F555ABA52F8B700CCACABFD505FA89BEDAFC95DB5C7B03AB270655F1C50BD1B1337B11A0617A07FC0136EFFA40369E6B699C7728DA03

// E2ADE05535841F094BB68F989FFD9E9C9B6719DEFB35D701CCD2CF872828713CE465F92DEFB9A445F24139B4C98190448F0A176B272EEE58511E4E0C221AC1A655AA4BBC4BE6C23D7FDFFD6563BAD0FEC2273D73FD41EF49D1CC1331341BC177F0C8C8FCE809498A5D87A6D272326DCD683DE33AC870011365BD04E02B1DD6E3

// C78BEADCF0B4C04363874F0F2AB479B15CADB922C5E53C577A7BB3DD52EC70BE81AAC576AF5CBCD4C1896D5023D009DC9BE7056C6F0B9C22C3E4E2CA3CB246E97928F291D1A07368845DDBF7EFBD15D53250EA55DD356356435300A1907E17BF092B31B59DD8170EE44B3119D746A419CE406636352381B71F120C4FEEA219BF

// E03F44E14E7537089416B31F26BD6C2D3005A12639C9469D030F2FDEA6CAA788F5E026098A21C9C4D3A201431C4399976B9E9B78F19B73E011DF4FD1DFC3307A217CEC918151FDA79ABCD5707BA8F988EE6E59C522170BD5F6EE47C5085C66E1B3BF15932DD06A13F0B3A880BA82EE7D0F491DDD2F4351CFB7A208219283A6E3
